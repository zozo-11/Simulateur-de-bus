:root {
  color-scheme: dark;
  font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
  --bg: #0f141c;
  --panel: rgba(18, 24, 32, 0.88);
  --panel-border: rgba(255, 255, 255, 0.08);
  --accent: #52a8ff;
  --accent-strong: #1e7aff;
  --text: #f7fbff;
  --text-dim: rgba(255, 255, 255, 0.7);
  --danger: #ff4f6d;
  --warning: #ffcc4d;
  --safe-zone-inset: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}

* {
  box-sizing: border-box;
}

html,
body {
  margin: 0;
  background: radial-gradient(circle at center, rgba(35, 48, 64, 0.95), #05070b 85%);
  color: var(--text);
  min-height: 100%;
}

body {
  display: flex;
  align-items: center;
  justify-content: center;
  touch-action: none;
  -webkit-user-select: none;
  user-select: none;
  overflow: hidden;
}

.app {
  position: relative;
  width: min(1200px, 100vw);
  height: min(720px, 100vh);
  padding: max(env(safe-area-inset-top), 12px) max(env(safe-area-inset-right), 12px) max(env(safe-area-inset-bottom), 12px) max(env(safe-area-inset-left), 12px);
  display: grid;
  grid-template-columns: 1fr min(340px, 38%);
  grid-template-rows: 1fr;
  gap: 14px;
}

.safe-area {
  position: absolute;
  inset: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  pointer-events: none;
}

.scene-container {
  position: relative;
  border-radius: 18px;
  overflow: hidden;
  background: linear-gradient(180deg, rgba(12, 18, 28, 0.96), rgba(6, 8, 12, 0.96));
  border: 1px solid var(--panel-border);
  box-shadow: 0 24px 64px rgba(0, 0, 0, 0.45);
}

.scene-canvas {
  width: 100%;
  height: 100%;
  display: block;
  background: radial-gradient(circle at 30% 30%, rgba(80, 96, 120, 0.12), rgba(0, 0, 0, 0.92));
}

.hud {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: clamp(12px, 2vw, 28px);
  pointer-events: none;
}

.hud-row {
  display: flex;
  gap: clamp(10px, 2.5vw, 24px);
  align-items: center;
  flex-wrap: wrap;
}

.hud-row.primary {
  justify-content: space-between;
}

.hud-block {
  background: rgba(12, 16, 22, 0.72);
  border-radius: 12px;
  padding: 10px 14px;
  min-width: 110px;
  border: 1px solid rgba(255, 255, 255, 0.04);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
}

.hud-block .hud-label {
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--text-dim);
}

.hud-value {
  display: block;
  font-size: clamp(1rem, 2vw, 1.8rem);
  font-weight: 600;
}

.hud-gear {
  display: grid;
  grid-template-columns: auto auto;
  align-items: center;
  gap: 8px;
}

.hud-trend::before {
  content: attr(data-trend);
  font-size: 1.2rem;
  color: var(--accent);
}

.hud-row.secondary {
  justify-content: flex-start;
}

.hud-indicator {
  background: rgba(10, 14, 20, 0.66);
  border-radius: 999px;
  padding: 6px 14px;
  border: 1px solid rgba(255, 255, 255, 0.04);
  font-size: 0.85rem;
  min-width: 54px;
  text-align: center;
  opacity: 0.25;
  transition: opacity 0.18s ease, background 0.18s ease, color 0.18s ease;
}

.hud-indicator.active {
  opacity: 1;
  background: rgba(82, 168, 255, 0.22);
  color: var(--accent);
}

#hud-k.active {
  background: rgba(255, 204, 77, 0.26);
  color: var(--warning);
}

#hud-stop.active {
  background: rgba(255, 79, 109, 0.26);
  color: var(--danger);
}

.hud-bars {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 12px;
}

.hud-bar {
  background: rgba(10, 12, 18, 0.6);
  border-radius: 12px;
  padding: 8px 12px;
  border: 1px solid rgba(255, 255, 255, 0.04);
}

.bar-track {
  position: relative;
  height: 8px;
  margin-top: 6px;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 6px;
  overflow: hidden;
}

.bar-fill {
  width: 0%;
  height: 100%;
  background: linear-gradient(90deg, rgba(30, 122, 255, 0.9), rgba(82, 168, 255, 0.4));
  transition: width 0.12s ease;
}

.controls {
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: minmax(0, 1fr);
  gap: 16px;
  background: var(--panel);
  border-radius: 18px;
  border: 1px solid var(--panel-border);
  padding: clamp(14px, 3vw, 22px);
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.45);
}

.wheel-panel {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

.wheel-shadow {
  position: absolute;
  width: clamp(220px, 34vw, 320px);
  height: clamp(220px, 34vw, 320px);
  background: radial-gradient(circle, rgba(0, 0, 0, 0.35), transparent 70%);
  filter: blur(28px);
  top: clamp(10px, 2vw, 30px);
  z-index: 0;
}

.wheel {
  position: relative;
  width: clamp(240px, 36vw, 340px);
  aspect-ratio: 1;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.12), rgba(15, 22, 32, 0.95));
  border: 6px solid rgba(0, 0, 0, 0.55);
  box-shadow: inset 0 6px 20px rgba(0, 0, 0, 0.6), 0 6px 20px rgba(0, 0, 0, 0.45);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: grab;
  touch-action: none;
  z-index: 1;
  transition: box-shadow 0.15s ease;
}

.wheel:active {
  cursor: grabbing;
  box-shadow: inset 0 6px 28px rgba(0, 0, 0, 0.72), 0 10px 28px rgba(0, 0, 0, 0.52);
}

.wheel-center {
  width: 32%;
  aspect-ratio: 1;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.18), rgba(20, 24, 30, 0.94));
  border: 4px solid rgba(0, 0, 0, 0.6);
}

.wheel-spoke {
  position: absolute;
  width: 12%;
  height: 50%;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.16), rgba(0, 0, 0, 0.7));
  border-radius: 999px;
  top: 0;
  left: 50%;
  transform-origin: 50% 100%;
}

.spoke-0 {
  transform: translateX(-50%) rotate(0deg);
}

.spoke-1 {
  transform: translateX(-50%) rotate(120deg);
}

.spoke-2 {
  transform: translateX(-50%) rotate(240deg);
}

.wheel-indicator {
  font-size: 0.95rem;
  color: var(--text-dim);
}

.wheel-settings {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  padding: 6px 10px 0;
}

.wheel-settings label {
  font-size: 0.75rem;
  letter-spacing: 0.02em;
  text-transform: uppercase;
  color: var(--text-dim);
}

.wheel-settings select {
  background: rgba(15, 22, 32, 0.9);
  color: var(--text-primary);
  border: 1px solid rgba(82, 168, 255, 0.32);
  border-radius: 12px;
  padding: 6px 20px;
  font-size: 0.85rem;
  min-width: 120px;
  appearance: none;
  text-align: center;
  cursor: pointer;
}

.wheel-settings select:focus-visible {
  outline: 2px solid rgba(82, 168, 255, 0.6);
  outline-offset: 2px;
}

.pedal-panel {
  display: flex;
  gap: clamp(16px, 2.8vw, 28px);
  justify-content: center;
  align-items: stretch;
}

.slider {
  position: relative;
  width: clamp(110px, 12vw, 132px);
  min-width: 44px;
  border-radius: 16px;
  background: rgba(9, 12, 18, 0.78);
  border: 1px solid rgba(255, 255, 255, 0.04);
  padding: 14px 0;
  display: flex;
  align-items: center;
  justify-content: center;
  touch-action: none;
}

.slider-track {
  position: relative;
  width: 34%;
  min-width: 44px;
  height: 100%;
  background: linear-gradient(180deg, rgba(26, 38, 52, 0.6), rgba(10, 14, 22, 0.9));
  border-radius: 999px;
  overflow: hidden;
}

.slider-fill {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 0%;
  background: linear-gradient(180deg, rgba(30, 122, 255, 0.9), rgba(82, 168, 255, 0.35));
  border-radius: 999px;
  transition: height 0.1s ease;
}

.slider-handle {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  width: max(56px, 7vw);
  height: 56px;
  border-radius: 18px;
  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.18), rgba(15, 18, 24, 0.92));
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.05rem;
  font-weight: 600;
  color: var(--text);
}

.slider-value {
  pointer-events: none;
}

.slider-detent {
  position: absolute;
  left: 50%;
  width: 90%;
  transform: translateX(-50%);
  height: 6px;
  border-radius: 4px;
  background: rgba(255, 255, 255, 0.12);
  opacity: 0.4;
}

.detent-pre {
  top: 10%;
}

.detent-threshold {
  top: 15%;
  background: rgba(255, 79, 109, 0.35);
}

.detent-kickdown {
  bottom: 13%;
  height: 8px;
  background: rgba(82, 168, 255, 0.45);
}

.camera-toggle {
  position: absolute;
  bottom: max(env(safe-area-inset-bottom), 24px);
  left: 50%;
  transform: translateX(-50%);
  background: rgba(12, 18, 28, 0.88);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 999px;
  padding: 12px 24px;
  color: var(--text);
  font-size: 0.95rem;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  cursor: pointer;
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
}

.camera-toggle:active {
  transform: translateX(-50%) scale(0.97);
}

.touch-shield {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

@media (max-width: 1024px) {
  .app {
    grid-template-columns: 1fr;
    grid-template-rows: minmax(0, 1fr) auto;
    height: 100vh;
    width: 100vw;
  }

  .controls {
    grid-template-columns: minmax(0, 1fr);
    grid-template-rows: auto 1fr;
    align-items: center;
  }

  .pedal-panel {
    width: 100%;
    justify-content: space-evenly;
  }

  .camera-toggle {
    position: fixed;
  }
}

@media (max-width: 720px) {
  body {
    font-size: 14px;
  }

  .slider {
    width: clamp(90px, 18vw, 120px);
  }

  .wheel {
    width: clamp(200px, 70vw, 300px);
  }
}
